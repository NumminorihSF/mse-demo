<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Managed Media Source demo page</title>
    <script src="https://numminorihsf.github.io/mse-demo/dummy-player.js"></script>
</head>
<body>
<h1>Managed Media Source demo</h1>
<div><a href="index.html">Index</a></div>
<div>
    <video controls width="80%"></video>
</div>

<script>
    function getMediaSource() {
        if (window.ManagedMediaSource) {
            return new window.ManagedMediaSource();
        }
        if (window.MediaSource) {
            return new window.MediaSource();
        }

        throw new Error('No MediaSource API available');
    }

    const video = document.querySelector('video');

    // Создание объекта MediaSource
    const ms = getMediaSource();
    // Связывание <video> с объектом MediaSource
    video.src = URL.createObjectURL(ms);
    // Подписка на событие перехода объекта MediaSource в состояние open.
    // Это значит, что source был открыт <video> и готов к добавлению данных к объектам SourceBuffer в sourceBuffers.
    ms.addEventListener('sourceopen', onMediaSourceOpen);

    ms.addEventListener('startstreaming', (e) => {
        console.log('Browser recommends to start streaming', e);
    });

    ms.addEventListener('endstreaming', (e) => {
        console.log('Browser recommends to end streaming', e);
    });

    ms.addEventListener('qualitychange', (e) => {
        console.log('Browser recommends to change video quality', e);
    });
</script>
</body>
</html>
