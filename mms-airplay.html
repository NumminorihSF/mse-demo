<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Managed Media Source with AirPlay demo page</title>
    <script src="https://numminorihsf.github.io/mse-demo/dummy-player.js"></script>
</head>
<body>
<h1>Managed Media Source with AirPlay demo</h1>
<div><a href="index.html">Index</a></div>
<div>
    <video controls width="80%"></video>
</div>

<script>
    function getMediaSource() {
        if (window.ManagedMediaSource) {
            return new window.ManagedMediaSource();
        }
        if (window.MediaSource) {
            return new window.MediaSource();
        }

        throw new Error('No MediaSource API available');
    }

    const video = document.querySelector('video');

    // Создание объекта MediaSource
    const ms = getMediaSource();
    // Создание объекта Source для MMS
    const blobSource = document.createElement('source');
    blobSource.type = 'video/mp4';
    blobSource.src = URL.createObjectURL(ms);

    // Создание объекта Source для AirPlay
    const airPlaySource = document.createElement('source');
    airPlaySource.type = 'application/x-mpegURL';
    airPlaySource.src = 'https://numminorihsf.github.io/mse-demo/streams/master.m3u8';

    video.appendChild(blobSource);
    video.appendChild(airPlaySource);
    // Подписка на событие перехода объекта MediaSource в состояние open.
    // Это значит, что source был открыт <video> и готов к добавлению данных к объектам SourceBuffer в sourceBuffers.
    ms.addEventListener('sourceopen', onMediaSourceOpen);
</script>
</body>
</html>
