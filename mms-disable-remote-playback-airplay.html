<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Managed Media Source disableRemotePlayback with airplay demo page</title>
    <script src="https://numminorihsf.github.io/mse-demo/dummy-player.js"></script>
</head>
<body>
<h1>Managed Media Source disableRemotePlayback with airplay demo</h1>
<div><a href="index.html">Index</a></div>
<div>
    <video x-webkit-airplay="allow" playsinline controls width="80%"></video>
</div>

<script>
    function getMediaSource() {
        if (window.ManagedMediaSource) {
            return new window.ManagedMediaSource();
        }
        if (window.MediaSource) {
            return new window.MediaSource();
        }

        throw new Error('No MediaSource API available');
    }

    const video = document.querySelector('video');

    // Создание объекта MediaSource
    const ms = getMediaSource();
    // Создание объекта Source для MMS
    const blob = URL.createObjectURL(ms);
    video.src = blob;
    video.disableRemotePlayback = true;
    video.addEventListener('webkitcurrentplaybacktargetiswirelesschanged',
        function (event) {
            console.log(event);
            const {currentTime} = video;
            if (video.disableRemotePlayback) {
                disablePlayer();
                video.disableRemotePlayback = false;
                video.src = 'https://numminorihsf.github.io/mse-demo/streams/master.m3u8';
                video.currentTime = currentTime;
                video.play();
            } else {
                video.disableRemotePlayback = true;
                video.src = blob;
                enablePlayer();
                video.currentTime = currentTime;
                video.play();
            }
        });
    // Подписка на событие перехода объекта MediaSource в состояние open.
    // Это значит, что source был открыт <video> и готов к добавлению данных к объектам SourceBuffer в sourceBuffers.
    ms.addEventListener('sourceopen', onMediaSourceOpen);
</script>
</body>
</html>
